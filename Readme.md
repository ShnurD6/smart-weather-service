# Умный сервис прогноза погоды
**Средний уровень сложности**

- Для работы сервиса используется язык программирования C++
- Сервис написан с архитектурой клиент-сервер, поэтому клиентом может быть что угодно. Пока, для простоты, реализован только консольный клиентский интерфейс, но в планах прикрутить Telegram
- Возможности "сервера":
    - Получение ответа по координатам
    - Получаение ответа по названию города
- Формат ответа - текст. Данные, полученные из API (температура, её ощущение, описание погоды и влажность воздуха) подставляются в текстовый шаблон. В итоге, в зависимости от данных, получается что-то вроде 

````
Ваш прогноз погоды ☄:

Сейчас температура составляет 22℃, но ощущается как 21℃ :)
На улице небольшой дождь,
влажность воздуха составляет 83%,
скорость ветра 6.7 м/c
````

- Всё, кроме [JsonParser](https://github.com/nlohmann/json "Тут ссылка на использованный мной модуль для парсига JSON"), написано мной в рамках работы над этим проктом

---

Процесс работы "сервера" (далее -- ядро):
- Данные (координаты или название города) от пользователя передаются клиентом в ядро.
- Если это название города: 
    - Запрос сначала улетает в на апи https://opencagedata.com/, которое возращает список городов, которые удалось найти.
    - Реквест регестрируется, координаты городов сохраняются в ядре 
    - Далее, клиенту возвращается Id его реквеста и список возможных городов. 
    - С этим Id и уточнённым номером города теперь можно вызывать функцию SpecifyCity, которая ассоциирует номер города и реквеста с координатами и перенаправит запрос на выдачу ответа ядра по координатам (ниже) 
- Если это координаты, или у нас уже есть координаты из предыдущего шага:
    - Отправляем их на апи http://openweathermap.org, оно говорит нам данные о погоде
    - Погоду используем для формирования ответа (процесс формирования описан выше)

---

Процесс работы Telegram-клиента

- Если это сообщение с координатами (локация):
    - Широта и долгота перенаправляются в ядро
    - Ответ возвращается пользователю ответом на исходное сообщение
- Если сообщение с названием города:
    - Сначала запрос идёт в ядро, получается список городов с Id реквеста. В случае ошибки - она возвращается пользователю ответом на сообщение
    - Список городов превращается в кнопки с уточнёнными названиями. В каждую кнопку вложен callback, отправляющий query формата `RequestId&CityNum&MessageId`
    - При нажатии на кнопку query обрабатывается, делается запрос в ядро, пользователю возвращается ответ реплаем на исходное сообщение 

---

Как это запустить:

1) Добавить в корень проекта токены для api.openweathermap.org и api.opencagedata.com, в файлы WeatherToken.api и CitiesToken.api соответственно
2) `docker build -t smart-weather-service -f Dockerfile.dockerfile .`
3) `docker run -it smart-weather-service`

Если вы не хотите ставить докер (это просто, поверьте) - [есть возможность собрать всё вручную](ManualBuild.md "ссылка на инструкцию")

_p.s. Если нужны токены -- напишите в телеграм @shnurd6, я скину)_
